{% extends "site_base.html" %}

{% load i18n %}
{% load bootstrap_tags %}

{% block head_title %}{% trans "Work" %}{% endblock %}

{% block extra_head %}


<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />

<style>

.commitmentForm .modal-body {
	max-height: 500px;
}

.commitmentForm {
	width: 800px;
	/* margin: -250px 0 0 -300px; */
}


</style>
{% endblock %}

{% block body_class %}work{% endblock %}

{% block body_base %}
    <div class="container">
        {% include "_messages.html" %}
	<div>
		<legend>{% trans "Work" %}</legend>

{% comment %}
			<p>
				<a href="{% url timeline %}">{% trans "Timeline" %}</a>
			</p>
{% endcomment %}

		<div class="row-fluid">
			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "My work in process" %}:</h3>

				{% if my_work %}
						<ul>
							{% for item in my_work %}
								<li>
									<b>{{ item.resource_type.name }}:</b> {{ item.quantity }} {{ item.unit_of_quantity }} {% trans "due" %} {{ item.due_date }}
									<a href="{% url work_commitment commitment_id=item.id %}" role="button" class="btn btn-info" >{% trans "Work this task" %}</a>
								</li>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for process" %}: {{ item.process }}
								</p>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for order" %}: {{ item.independent_demand }}
								</p>


							{% endfor %}
						</ul>
				{% else %}
				None
				{% endif %}

			</div>

			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "Unassigned tasks using my skillz" %}:</h3>

				{% if my_skillz %}
						<ul>
							{% for item in my_skillz %}
								<li>
									<b>{{ item.resource_type.name }}:</b> {{ item.quantity }} {{ item.unit_of_quantity }} {% trans "due" %} {{ item.due_date }}
									{% if user.is_authenticated %}
										<div style="display: inline;" >
											<a href="#commitmentForm{{ item.id }}" role="button" class="btn btn-info" data-toggle="modal">
												{% trans "Take this task" %}
											</a>
										</div>

										<div class="modal hide fade commitmentForm" id="commitmentForm{{ item.id }}" tabindex="-1" role="dialog" aria-labelledby="commitment-label" aria-hidden="true">
											<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
												<h3 id="commitment-label">{% trans "Take this task" %}: {{ item }}</h3>
											</div>
											<div class="modal-body">

												<div class="row-fluid">
													<div class="span5">
														<form class="commitmentForm" enctype="multipart/form-data" action="{% url commit_to_task commitment_id=item.id %}" method="POST" >
															{% csrf_token %}
															{{ item.commitment_form|as_bootstrap }}
															<input type="hidden" name="next" value="{% url work %}" />
														  <div class="modal-footer">
															<button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel" %}</button>
															<button class="btn btn-primary">{% trans "Commit" %}</button>
														  </div>
														</form>
													</div>
													<div class="span7">
														<h4>
															{{ item.resource_type.name }}: {{ item.quantity }} {{ item.unit_of_quantity }} {% trans "due" %} {{ item.due_date }}
														</h4>
														<p style="margin-left: 1em; margin-bottom: 0;">
															{% trans "for process" %}: {{ item.process }}
														</p>
														<p style="margin-left: 1em;">
															{% trans "for order" %}: {{ item.independent_demand }}
														</p>
														<h4>{% trans "Material requirements" %}:</h4>
														{% for reqmt in item.process.material_requirements %}	
															<p style="margin-left: 1em;">
																{{ reqmt.resource_type.name }}: {{ reqmt.quantity }} {{ reqmt.unit_of_quantity }}
															</p>
															<ul>
																{% for source in reqmt.resource_type.producing_agent_relationships %}
																	<p style="margin-left: 2em;">
																		<b>{% trans "Possible source" %}:</b> {{ source.agent.name }} 
																		{% trans "Lead time" %}: {{ source.lead_time }} {% trans "days" %}
																	</p>
																{% endfor %}
															</ul>
														{% endfor %}
														<h4>{% trans "Tool Requirements" %}:</h4>
														{% for reqmt in item.process.tool_requirements %}	
															<p style="margin-left: 1em;">

																{{ reqmt.resource_type.name }}: {{ reqmt.quantity }}{{ reqmt.unit_of_quantity }}
															</p>
															<ul>
																{% for source in reqmt.resource_type.producing_agent_relationships %}
																	<li>
																		<b>{% trans "Possible source" %}:</b> {{ source.agent.name }} {% trans "Lead time" %}: {{ source.lead_time }} {% trans "days" %}
																	</li>
																{% endfor %}
															</ul>
														{% endfor %}
													</div>
												</div>
										  </div>

										</div>

									{% endif %}
								</li>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for process" %}: {{ item.process }}
								</p>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for order" %}: {{ item.independent_demand }}
								</p>


							{% endfor %}
						</ul>
				{% else %}
				None
				{% endif %}

			</div>

		</div>

		<div class="row-fluid">
			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "Log unscheduled time contribution" %}:</h3>

			</div>
			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "My recent time contributions" %}:</h3>

			</div>
		</div>


		<div class="row-fluid">
			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "Other unassigned tasks" %}:</h3>

				{% if other_unassigned %}
						<ul>
							{% for item in other_unassigned %}
								<li>
									<b>{{ item.resource_type.name }}:</b> {{ item.quantity }} {{ item.unit_of_quantity }} {% trans "due" %} {{ item.due_date }}
								</li>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for process" %}: {{ item.process }}
								</p>
								<p style="margin-left: 1em; margin-bottom: 0;">
									{% trans "for order" %}: {{ item.independent_demand }}
								</p>
		                        <ul>
									{% for source in item.resource_type.producing_agent_relationships %}
										<li>
											<b>{% trans "Possible source" %}:</b> {{ source.agent.name }}
										</li>
									{% endfor %}
								</ul>
							{% endfor %}
						</ul>
				{% else %}
				None
				{% endif %}

			</div>
			<div class="span6">

				<h3 style="margin-bottom: 4px;" >{% trans "Other work in process" %}:</h3>

			</div>
		</div>


	</div>
    </div>
{% endblock %}
{% block extra_script %}
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
{% endblock %}

{% block extra_body %}
	{{ block.super }}

    <script type="text/javascript">

	$(document).ready(function(){
		$('.date-entry').datepicker({ dateFormat: "yy-mm-dd" });

/*
		$('input').filter('.date-entry').datepicker({ dateFormat: "yy-mm-dd" });

		$(function() {
        	$( ".date-entry" ).each( function(){
				$(this).datepicker({ dateFormat: "yy-mm-dd" });
			});
    	});
*/
	}); // end document.ready
    </script>

{% endblock %}
