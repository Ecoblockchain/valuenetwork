{% extends "site_base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Schedule for " %}{{ order }}{% endblock %}

{% block extra_head %}

<style>

.error {
    color: red;
}

.reskedForm {
    display: inline;
}

li {
    list-style-type: none;
}
.project-line {
    font-size: 1.2em;
    color: brown;
    font-weight: bold;
    margin-top: 1.5em;
}

.process {
    font-weight: bold;
    font-size: 1.1em;
    margin-top: .8em;
    background-color: lightyellow;
    border: 1px solid gainsboro;
    padding: 1em;
}

.resource-type {
    font-weight: bold;
    font-size: 1.1em;
}

.for, .req-description {
    font-size: .8em;
    font-style: italic;
    font-weight: normal;
}
.section {
    color:     #008A2E;
    font-size: 1em;
}
.indent {
    margin-left: 1em;
}

</style>

{% endblock %}

{% block body_class %}projects{% endblock %}

{% block body_base %}
    <div class="container">
        {% include "_messages.html" %}
	<div>
		<legend>{% trans "Schedule for " %}{{ order }}</legend>
		
            {% if order.description %}
                <p>{{ order.description|urlize|linebreaks }}</p>
            {% endif %}

            <h3>
			    {% if order.order_type == "customer" %}
		            {% trans "Order Items" %}:
	            {% else %}
	                {% trans "Deliverables" %}:
	            {% endif %}
	        </h3>
        
			<ul>
			    {% for item in order.producing_commitments %}
					<li>
					    <span class="resource-type">
                            {{ item.resource_type }}
                            {% if item.stage %}
                                @{{ item.stage.name }}
                            {% endif %}
                        </span> {{ item.quantity }} {{ item.unit_of_quantity }}
                        {% if item.stage %}
                            <div style="display: inline;" >
                                <a href="#resourceQuantity" role="button" class="btn btn-primary indent" data-toggle="modal">{% trans "Change Quantity" %}</a>
                            </div>
                        {% endif %}
			            {% if item.description %}
			               <div class="req-description"> {{ item.description|urlize|linebreaks }}</div>
		                {% endif %}
				    </li>
				{% endfor %}
			</ul>

			<div class="modal hide fade" id="resourceQuantity" tabindex="-1" role="dialog" aria-labelledby="resource-qty-label" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                    <h3 id="resource-qty-label">{% trans "Change resource quantity for workflow plan" %} </h3>
                </div>
                <div class="modal-body">
                    <form class="resource-qty-form" enctype="multipart/form-data" action="{% url change_commitment_quantities order_id=order.id %}" method="POST" >
                        {% csrf_token %}
                        {{ resource_qty_form }} {{ unit }}
                        <p>This will change all the planned quantities for the workflow resource on all processes for this order.</p>
                        <p>If work inputs also are using the same quantity and unit, they will also be changed.</p>
                        <input type="hidden" name="next" value="{% url order_schedule order_id=order.id %}" />
                        <div class="modal-footer">
                            <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Cancel" %}</button>
                            <button class="btn btn-primary">{% trans "Save changes" %}</button>
                        </div>
                    </form>
                </div>
			</div>
			
			<div class="row-fluid">

				<div class="span12">
					<h3 style="margin-bottom: 4px;" >
					    {% trans "Production Schedule" %}:
					    <a class="indent" href="{% url processes_graph object_type='O' object_id=order.id %}">Process graph diagram</a>
				    </h3> 
					
					{% for process in processes %}
					    {% comment %}
						<ul style="margin-left:{{ process.depth|add:"4" }}em" >
						{% endcomment %}
						<ul>
						    <li class="process" >{% include  "valueaccounting/_process_for_order.html" %}</li>
						 </ul>

					{% empty %}
					    <p class="text-error" >{{ error_message }}</p>
					{% endfor %}
				</div>

			</div>

	</div>
    </div>
{% endblock %}
